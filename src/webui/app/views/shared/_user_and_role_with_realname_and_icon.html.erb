<% short ||= false %>
<% no_icon ||= false %>
<% no_link ||= false %>
<% realname = Person.realname_for_login(user) %>

<% unless no_icon %>
  <%= user_icon(user) %>
<% end %>

<% unless realname.empty? or short == true %>
  <% printed_name = realname + ' (' + user + ')' %>
<% else %>
  <% printed_name = user %>
<% end %>
<% if role %>
  <% printed_name += " as " + role %>
<% end %>
<% if @user %>
  <%= link_to_if(!no_link, printed_name, :controller => 'home', :user => user) %>
<% else %>
  <%= printed_name %>
<% end %>
