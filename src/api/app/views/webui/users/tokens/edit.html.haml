- @pagetitle = 'Edit Token'

.card
  .card-body
    %h3.mb-3= @pagetitle

    .row
      .col-12.col-md-10.col-lg-8
        = form_with(url: token_path, scope: :token, method: :put, local: true) do |f|
          .form-row.d-none#created-token
            .col-12.col-md-10.col-lg-9
              %fieldset.form-group
                = f.label(:string_readonly, 'Your new OBS Personal Access Token Secret', class: 'col-form-label col-form-label-lg')
                .input-group
                  = render CopyToClipboardInputComponent.new(form_builder: f)
              %hr

          .form-row
            .col-12.col-md-10.col-lg-9
              .form-group
                = f.label(:id, 'Id:')
                = @token.id
              .form-group
                = f.label(:type, 'Operation:')
                = @token.class.token_name.capitalize
              .form-group
                = f.label(:name, 'Name:')
                %span.d-none#original-token-name
                  = @token.name
                .input-group#token-name-text-field
                  = f.text_field(:name, class: 'form-control', placeholder: 'Eg: Rebuild vim package', maxlength: 64)
              - if @token.package.present?
                .form-group
                  = f.label(:type, 'Package:')
                  = link_to("#{@token.package.project.name}/#{@token.package.name}",
                    package_show_path(project: @token.package.project, package: @token.package))
              .form-group#regenerate-token-group
                = link_to('Regenerate Token', '#', title: 'Regenerate Token', class: 'btn btn-outline-danger float-right ml-3 px-4',
                  data: { toggle: 'modal', target: '#regenerate-token-modal' })
                If your token has been lost, forgotten or compromised, you can regenerate it.
                Don't forget to replace the string in any scripts or applications using this token.
              - if @token.type == 'Token::Workflow'
                .form-group#scm-token-group
                  = f.label(:scm_token) do
                    SCM token:
                  .input-group
                    = f.password_field(:scm_token, size: 80, class: 'form-control', placeholder: 'Please enter your new SCM token')
                  .form-text.text-muted
                    Leaving this text field empty will not update your SCM token.
          .actions
            = link_to('Cancel', tokens_path, title: 'Cancel', class: 'btn btn-outline-secondary px-4 mr-3 mt-3 mt-sm-0')
            = f.submit('Update', class: 'btn btn-primary px-4 mt-3 mt-sm-0')

.modal.fade#regenerate-token-modal{ tabindex: -1, role: 'dialog', aria: { labelledby: 'regenerate-token-modal-label', hidden: true } }
  .modal-dialog.modal-dialog-centered{ role: 'document' }
    .modal-content
      .modal-header
        %h5.modal-title#regenerate-token-modal-label Do you really want to regenerate this token string?
      .modal-body
        %p
          Please confirm that you want to regenerate this token string.
        = form_with(url: token_path, scope: :token, method: :put, local: false) do |f|
          .modal-footer
            %a.btn.btn-sm.btn-outline-secondary.px-4{ data: { dismiss: 'modal' } }
              Cancel
            = f.submit('Regenerate', class: 'btn btn-sm btn-danger px-4', data: { disable: { with: 'Regenerate' } })
