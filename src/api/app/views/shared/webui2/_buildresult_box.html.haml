- index ||= ''
- if defined?(package)
  - controller = 'package'
- else
  - controller = 'project'
.tabs.attached-to-box.is-small.is-boxed
  %ul{id: "result_select_#{index}"}
    %li.is-active{ data: { id: "result_display_#{index}_0" }, id: "result_select_link_#{index}_0" }
      %a{ href: '#' }
        %span.tab-title Build Results
        %span.action-icon.result_reload{ id: "result_reload_#{index}_0" }= sprite_tag('reload', title: 'Reload', onclick: "update_build_result_#{index}()")
        %span.action-icon.is-hidden{ id: "result_spinner_#{index}_0" }= image_tag('ajax-loader.gif')
    - if controller == 'package'
      %li{ data: { id: "result_display_#{index}_1" }, id: "result_select_link_#{index}_1" }
        %a{ href: '#' }
          %span.tab-title Rpmlint Results
          %span.action-icon.result_reload{ id: "result_reload_#{index}_1" }= sprite_tag('reload', title: 'Reload', onclick: "update_rpmlint_result_#{index}()")
          %span.action-icon.is-hidden{ id: "result_spinner_#{index}_1" }= image_tag('ajax-loader.gif')
.box.with-tabs
  .content-tab{ id: "result_display_#{index}_0" }
  - if controller == 'package'
    .content-tab.is-hidden{ id: "result_display_#{index}_1" }

- ajax_data = []
- ajax_data.push("'project': '#{h(project)}'") if defined?(project)
- ajax_data.push("'package': '#{h(package)}'") if defined?(package)
- ajax_data.push("'index': '#{index}'") if defined?(index)
- ajax_data = raw(ajax_data.join ', ')

= javascript_tag do
  - if controller == 'package'
    :plain
      function update_rpmlint_result_#{index}() {
        $('#result_spinner_#{index}_1').removeClass('is-hidden');
        $('#result_reload_#{index}_1').addClass('is-hidden');
        $.ajax({
          url: '#{ url_for(controller: controller, action: 'rpmlint_result') }',
          data: {#{ajax_data}},
          success: function(data) {
            $('#result_display_#{index}_1').html(data);
          },
          error: function(data) {
            $('#result_display_#{index}_1').html('<p>No rpmlint results available</p>');
          },
          complete: function(data) {
            $('#result_spinner_#{index}_1').addClass('is-hidden');
            if ($('#result_select_link_#{index}_1').hasClass('is-active')) {
              $('#result_reload_#{index}_1').removeClass('is-hidden');
            }
          }
        });
      }

      update_rpmlint_result_#{index}();

  :plain
    function update_build_result_#{index}() {
      $('#result_spinner_#{index}_0').removeClass('is-hidden');
      $('#result_reload_#{index}_0').addClass('is-hidden');
      $.ajax({
        url: '#{ url_for(controller: controller, action: 'buildresult') }',
        data: {
          'show_all': $('#show_all_#{index}').is(':checked'),
          #{ajax_data}
        },
        success: function(data) {
          $('#result_display_#{index}_0').html(data);
        },
        error: function(data) {
          $('#result_display_#{index}_0').html('<p>No build results available</p>');
        },
        complete: function(data) {
          $('#result_spinner_#{index}_0').addClass('is-hidden');
          if ($('#result_select_link_#{index}_0').hasClass('is-active')) {
            $('#result_reload_#{index}_0').removeClass('is-hidden');
          }
        }
      });
    }

    update_build_result_#{index}();
